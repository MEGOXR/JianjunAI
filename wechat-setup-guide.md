# 微信小程序WebSocket配置指南

## 1. 开发环境设置（立即解决）

在微信开发者工具中：
1. 点击右上角"详情"
2. 选择"本地设置"标签
3. 勾选以下选项：
   - ✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
   - ✅ 不校验 HTTPS 安全域名
   
这样可以在开发阶段跳过域名验证。

## 2. 生产环境配置（正式发布前必须）

### 2.1 微信公众平台设置
1. 登录 [微信公众平台](https://mp.weixin.qq.com)
2. 进入"开发" -> "开发管理" -> "开发设置"
3. 在"服务器域名"中配置：
   - **socket合法域名**: `wss://mego-xr.com`
   - **request合法域名**: `https://mego-xr.com`

### 2.2 域名要求
- 必须是已备案的域名
- 必须支持HTTPS/WSS
- SSL证书必须有效（不能是自签名证书）

### 2.3 SSL证书要求
- 证书必须由受信任的CA机构颁发
- 支持的证书类型：
  - DV SSL证书
  - OV SSL证书
  - EV SSL证书
- 不支持：
  - 自签名证书
  - 过期证书
  - 证书链不完整

## 3. 常见问题

### 错误：未完成的操作
原因：
1. 域名未在微信后台配置
2. SSL证书有问题
3. 开发工具未勾选"不校验域名"

### 错误：1008 Invalid user credentials
原因：WebSocket连接成功但缺少必需的头部信息

## 4. 测试步骤
1. 先在开发工具中勾选"不校验域名"进行测试
2. 确认功能正常后，配置微信后台域名
3. 取消勾选"不校验域名"，测试生产环境配置